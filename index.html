// App.jsx (или как у Вас называется главный компонент)
import React, { useState, useEffect, useRef } from 'react';
import { Play, Pause, SkipForward, SkipBack, Volume2, BatteryMedium, Disc, Activity, Radio, Mic2, Music2, ChevronLeft, ChevronRight } from 'lucide-react';
import { playlists } from './radioConfig';

// просто алиас, чтобы не переписывать внизу songs.map(...)
const songs = playlists;

const Cassette = ({ song, isActive, onClick }) => (
  <div 
    onClick={() => onClick(song)}
    className={`
      relative w-64 h-40 flex-shrink-0 rounded-lg border-[3px] cursor-pointer transition-all duration-300 transform group
      ${isActive ? 'border-orange-500/80 -translate-y-2 shadow-[0_15px_30px_rgba(249,115,22,0.4)] z-10' : 'border-neutral-700 hover:-translate-y-1 hover:shadow-[0_10px_20px_rgba(0,0,0,0.5)] hover:border-neutral-500'}
      bg-gradient-to-br from-neutral-800 via-neutral-900 to-black select-none overflow-hidden
    `}
    style={{
      backgroundImage: `url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.03' fill-rule='evenodd'%3E%3Cpath d='M5 0h1v1H5V0zM0 5h1v1H0V5z'/%3E%3C/g%3E%3C/svg%3E"), linear-gradient(to bottom right, #404040, #1a1a1a)`
    }}
  >
    {/* Plastic Texture & Reflections */}
    <div className="absolute inset-0 bg-gradient-to-b from-white/5 to-transparent pointer-events-none"></div>
    <div className="absolute inset-0 shadow-[inset_0_2px_5px_rgba(255,255,255,0.1),inset_0_-2px_5px_rgba(0,0,0,0.3)] rounded-lg pointer-events-none"></div>

    {/* Metallic Screws with more detail */}
    <div className="absolute top-1.5 left-1.5 w-2.5 h-2.5 rounded-full bg-neutral-400 shadow-[inset_1px_1px_1px_rgba(0,0,0,0.8),0_1px_1px_rgba(255,255,255,0.3)] border border-neutral-600 flex items-center justify-center">
        <div className="w-1.5 h-0.5 bg-neutral-600 rotate-45"></div>
    </div>
    <div className="absolute top-1.5 right-1.5 w-2.5 h-2.5 rounded-full bg-neutral-400 shadow-[inset_1px_1px_1px_rgba(0,0,0,0.8),0_1px_1px_rgba(255,255,255,0.3)] border border-neutral-600 flex items-center justify-center">
        <div className="w-1.5 h-0.5 bg-neutral-600 -rotate-45"></div>
    </div>
    <div className="absolute bottom-1.5 left-1.5 w-2.5 h-2.5 rounded-full bg-neutral-400 shadow-[inset_1px_1px_1px_rgba(0,0,0,0.8),0_1px_1px_rgba(255,255,255,0.3)] border border-neutral-600 flex items-center justify-center">
        <div className="w-1.5 h-0.5 bg-neutral-600 -rotate-45"></div>
    </div>
    <div className="absolute bottom-1.5 right-1.5 w-2.5 h-2.5 rounded-full bg-neutral-400 shadow-[inset_1px_1px_1px_rgba(0,0,0,0.8),0_1px_1px_rgba(255,255,255,0.3)] border border-neutral-600 flex items-center justify-center">
        <div className="w-1.5 h-0.5 bg-neutral-600 rotate-45"></div>
    </div>

    {/* Cassette Label & Window */}
    <div className="absolute inset-[10px] bg-[#d9d9d9] rounded-sm flex flex-col items-center border-2 border-neutral-500/30 shadow-[inset_0_0_10px_rgba(0,0,0,0.2)] overflow-hidden">
      
      {/* Label Top Area with Album Art Placeholder */}
      <div className="w-full h-12 bg-gradient-to-r from-[#f0e6d2] to-[#e6d8c0] flex items-center px-3 border-b-2 border-neutral-400 gap-3 relative">
        {/* Paper Texture */}
        <div className="absolute inset-0 opacity-30 pointer-events-none" style={{ backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='a'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.005' numOctaves='2' result='t'/%3E%3CfeColorMatrix type='matrix' values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 .1 0' in='t' result='c'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23a)' opacity='.5'/%3E%3C/svg%3E")`}}></div>

        {/* Album Art Placeholder */}
        <div className={`w-9 h-9 rounded-sm shadow-sm flex items-center justify-center border border-black/20 flex-shrink-0 ${song.coverColor}`}>
          <Music2 size={16} className="text-white/90" />
        </div>

        {/* Text Info */}
        <div className="flex flex-col flex-1 min-w-0 z-10">
            <div className="flex justify-between items-center w-full">
                <span className="font-handwriting text-base font-bold text-[#2c2c2c] truncate leading-none pt-1">{song.title}</span>
                <span className="font-mono text-[9px] text-[#555] font-bold ml-1 border border-[#777] px-1 rounded-sm">SIDE {song.side}</span>
            </div>
            <span className="font-handwriting text-xs text-[#444] truncate leading-tight">{song.artist}</span>
        </div>
      </div>

      {/* Tape Window */}
      <div className="flex-1 w-full flex items-center justify-center relative bg-neutral-800/30 px-2 py-1">
        <div className="w-full h-full bg-transparent rounded-sm border-[3px] border-neutral-500/40 relative overflow-hidden flex items-center justify-between px-4 shadow-[inset_0_0_5px_rgba(0,0,0,0.5)]">
          {/* Window Reflection */}
          <div className="absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-white/10 to-transparent pointer-events-none z-20"></div>
          
          {/* Tape Reels with more detail */}
          <div className={`w-10 h-10 rounded-full bg-gradient-to-br from-white to-neutral-300 border-4 border-neutral-700 flex items-center justify-center shadow-md ${isActive ? 'animate-spin-slow' : ''}`}>
            <div className="w-3 h-3 bg-neutral-700 rounded-full flex items-center justify-center">
                <div className="w-1 h-1 bg-neutral-400 rounded-full"></div>
            </div>
          </div>
          {/* Tape */}
          <div className="flex-1 h-5 bg-[#2a1b12] mx-2 rounded-sm relative overflow-hidden shadow-[inset_0_1px_3px_rgba(0,0,0,0.8)] border-t border-b border-[#1a110b]">
             <div className={`absolute top-0 left-0 h-full bg-gradient-to-r from-[#5a3b28] to-[#4a3020] w-1/2 rounded-r-sm ${isActive ? 'animate-pulse' : ''}`}></div>
          </div>
          <div className={`w-10 h-10 rounded-full bg-gradient-to-br from-white to-neutral-300 border-4 border-neutral-700 flex items-center justify-center shadow-md ${isActive ? 'animate-spin-slow' : ''}`}>
            <div className="w-3 h-3 bg-neutral-700 rounded-full flex items-center justify-center">
                <div className="w-1 h-1 bg-neutral-400 rounded-full"></div>
            </div>
          </div>
        </div>
      </div>
      
      {/* Label Bottom */}
      <div className="w-full h-5 bg-gradient-to-r from-[#f0e6d2] to-[#e6d8c0] flex items-center justify-center px-2 border-t-2 border-neutral-400 relative">
        {/* Paper Texture */}
        <div className="absolute inset-0 opacity-30 pointer-events-none" style={{ backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='a'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.005' numOctaves='2' result='t'/%3E%3CfeColorMatrix type='matrix' values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 .1 0' in='t' result='c'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23a)' opacity='.5'/%3E%3C/svg%3E")`}}></div>
        <span className="font-mono text-[9px] text-[#444] uppercase tracking-widest font-bold z-10">{song.type} • HIGH BIAS • 70μs EQ</span>
      </div>
    </div>
  </div>
);

const SpeakerGrille = () => (
  <div className="w-full h-full p-4 relative overflow-hidden rounded-[1.5rem] border-[5px] border-[#3a3a3a] shadow-[inset_3px_3px_8px_rgba(0,0,0,0.5),1px_1px_2px_rgba(255,255,255,0.1)] bg-[#222]">
    <div 
      className="absolute inset-0 opacity-90"
      style={{
        backgroundImage: `radial-gradient(circle at center, #111 1.5px, transparent 1.5px)`,
        backgroundSize: '5px 5px'
      }}
    ></div>
    <div className="absolute inset-0 bg-gradient-to-br from-transparent via-black/30 to-black/60"></div>
  </div>
);

const SpectrumVisualizer = ({ isPlaying }) => (
  <div className="flex items-end gap-[3px] h-10 bg-black/40 p-1 rounded-sm border border-white/5">
    {[...Array(16)].map((_, i) => (
      <div 
        key={i}
        className={`w-1.5 bg-gradient-to-t from-emerald-600 to-emerald-400 rounded-t-[1px] transition-all duration-150 ease-in-out ${isPlaying ? 'animate-spectrum' : 'h-1.5'}`}
        style={{ 
          animationDelay: `${i * 50}ms`,
          height: isPlaying ? `${Math.max(10, Math.random() * 100)}%` : '10%',
          opacity: 0.8 + (i % 2) * 0.2
        }}
      ></div>
    ))}
  </div>
);

const ControlButton = ({ children, onClick, isActive, className = '' }) => (
  <button 
    onClick={onClick}
    className={`
      relative flex items-center justify-center rounded-full transition-all active:scale-95
      bg-gradient-to-b from-[#555] to-[#333] border-[3px] border-[#2a2a2a]
      shadow-[0_4px_8px_rgba(0,0,0,0.5),inset_0_1px_2px_rgba(255,255,255,0.2)]
      active:shadow-[inset_0_3px_6px_rgba(0,0,0,0.6)] active:border-[#222]
      group
      ${className}
    `}
  >
    <div className={`
      absolute inset-1 rounded-full bg-gradient-to-b from-transparent to-black/20 pointer-events-none
      ${isActive ? 'from-orange-500/20 to-orange-700/40' : ''}
    `}></div>
    <div className={`text-neutral-300 group-hover:text-white transition-colors z-10 ${isActive ? 'text-orange-100' : ''}`}>
      {children}
    </div>
  </button>
);

export default function App() {
  const today = new Date().getDay(); // 0-6
  const [currentSong, setCurrentSong] = useState(() => {
    const soupOfDay =
      songs.find(
        (s) =>
          s.category === 'soup' &&
          Array.isArray(s.days) &&
          s.days.includes(today)
      ) || songs[0];
    return soupOfDay;
  });

  const [currentTrackIndex, setCurrentTrackIndex] = useState(0);
  const [isPlaying, setIsPlaying] = useState(true);   // пытаемся играть как радио
  const [currentTime, setCurrentTime] = useState(0);  // прогресс в %
  const [volume, setVolume] = useState(65);
  const scrollContainerRef = useRef(null);
  const audioRef = useRef(null);

  const tracks = currentSong.tracks || [];
  const currentTrack = tracks[currentTrackIndex] || null;
  const displayTitle = currentTrack?.title || currentSong.title;

  // Загружаем трек и управляем play/pause
  useEffect(() => {
    const audio = audioRef.current;
    if (!audio || !currentSong || !currentTrack) return;

    const base = (currentSong.folder || '').replace(/\/$/, '');
    const src = base ? `${base}/${currentTrack.file}` : currentTrack.file;

    if (audio.dataset.src !== src) {
      audio.src = src;
      audio.dataset.src = src;
      audio.load();
      setCurrentTime(0);
    }

    audio.volume = volume / 100;

    if (isPlaying) {
      const playPromise = audio.play();
      if (playPromise && playPromise.catch) {
        playPromise.catch(() => {
          // браузер мог заблокировать автоплей — тогда заиграет после первого клика
        });
      }
    } else {
      audio.pause();
    }
  }, [currentSong, currentTrack, isPlaying, volume]);

  // Обновляем прогресс и автоскейп на следующий трек
  useEffect(() => {
    const audio = audioRef.current;
    if (!audio) return;

    const handleTimeUpdate = () => {
      if (!audio.duration) {
        setCurrentTime(0);
        return;
      }
      const percent = (audio.currentTime / audio.duration) * 100;
      setCurrentTime(percent);
    };

    const handleEnded = () => {
      setCurrentTrackIndex((prev) => {
        if (!tracks.length) return 0;
        const next = prev + 1;
        return next < tracks.length ? next : 0;
      });
    };

    audio.addEventListener('timeupdate', handleTimeUpdate);
    audio.addEventListener('ended', handleEnded);
    return () => {
      audio.removeEventListener('timeupdate', handleTimeUpdate);
      audio.removeEventListener('ended', handleEnded);
    };
  }, [tracks.length]);

  const handleTapeSelect = (song) => {
    // переключаем кассету = другой суп/плейлист
    setIsPlaying(false);
    setCurrentTime(0);
    setCurrentTrackIndex(0);
    setTimeout(() => {
      setCurrentSong(song);
      setIsPlaying(true);
    }, 700);
  };

  const togglePlay = () => setIsPlaying((prev) => !prev);

  const handleNextTrack = () => {
    if (!tracks.length) return;
    setCurrentTrackIndex((prev) =>
      prev + 1 < tracks.length ? prev + 1 : 0
    );
    setIsPlaying(true);
  };

  const handlePrevTrack = () => {
    const audio = audioRef.current;
    if (audio && audio.currentTime > 3) {
      // если уже идёт трек — сначала просто в начало
      audio.currentTime = 0;
      return;
    }
    if (!tracks.length) return;
    setCurrentTrackIndex((prev) =>
      prev - 1 >= 0 ? prev - 1 : tracks.length - 1
    );
    setIsPlaying(true);
  };

  const scroll = (direction) => {
    if (scrollContainerRef.current) {
      const { current } = scrollContainerRef;
      const scrollAmount = 300;
      if (direction === 'left') {
        current.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
      } else {
        current.scrollBy({ left: scrollAmount, behavior: 'smooth' });
      }
    }
  };

  const handleVolumeChange = (e) => {
    const v = Number(e.target.value);
    setVolume(v);
    if (audioRef.current) {
      audioRef.current.volume = v / 100;
    }
  };

  return (
    <div className="min-h-screen bg-[#121212] text-neutral-200 font-sans flex flex-col items-center p-8 selection:bg-orange-500/50">
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@400;600&family=Caveat:wght@700&display=swap');
        .font-mono { font-family: 'Space Mono', monospace; }
        .font-handwriting { font-family: 'Caveat', cursive; }
        .animate-spin-slow { animation: spin 3s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes spectrum {
          0%, 100% { height: 10%; }
          50% { height: 90%; }
        }
        .animate-spectrum { animation: spectrum 0.8s ease-in-out infinite alternate; }
        .brushed-metal {
          background-color: #4a4a4a;
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Cpath fill='%23000000' fill-opacity='0.1' d='M1 3h1v1H1V3zm2-2h1v1H3V1z'/%3E%3C/svg%3E"), linear-gradient(to bottom, #777, #444);
        }
        .wood-shelf {
            background-color: #6d4c41;
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%233e2723' fill-opacity='0.1' fill-rule='evenodd'%3E%3Cpath d='M0 0h20v20H0V0zm10 10h10v10H10V10zM0 10h10v10H0V10zM10 0h10v10H10V0z'/%3E%3C/g%3E%3C/svg%3E"), linear-gradient(to bottom, #8d6e63, #5d4037);
        }
        .no-scrollbar::-webkit-scrollbar {
          display: none;
        }
        .no-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
      `}</style>

      {/* Title */}
      <h2 className="text-2xl font-bold tracking-widest text-neutral-300 mb-8 uppercase text-center flex items-center justify-center gap-4 text-shadow-sm">
          <Disc className="text-orange-600 drop-shadow-md" size={28} /> Collection Shelf <Disc className="text-orange-600 drop-shadow-md" size={28} />
      </h2>

      {/* Single Shelf Container with Arrows */}
      <div className="w-full max-w-5xl mb-12 relative group/shelf">
        
        {/* Left Arrow */}
        <button 
            onClick={() => scroll('left')}
            className="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 z-20 p-3 rounded-full bg-neutral-800/80 text-neutral-300 hover:text-orange-500 hover:bg-neutral-700 border-2 border-neutral-600 shadow-lg transition-all opacity-0 group-hover/shelf:opacity-100 focus:opacity-100 active:scale-95 hidden md:flex"
        >
            <ChevronLeft size={24} />
        </button>

        {/* Right Arrow */}
        <button 
            onClick={() => scroll('right')}
            className="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 z-20 p-3 rounded-full bg-neutral-800/80 text-neutral-300 hover:text-orange-500 hover:bg-neutral-700 border-2 border-neutral-600 shadow-lg transition-all opacity-0 group-hover/shelf:opacity-100 focus:opacity-100 active:scale-95 hidden md:flex"
        >
            <ChevronRight size={24} />
        </button>

        {/* Scrollable Shelf Area */}
        <div className="wood-shelf rounded-lg p-6 shadow-[0_20px_50px_rgba(0,0,0,0.8),inset_0_2px_5px_rgba(255,255,255,0.1)] border-[3px] border-[#4e342e] relative overflow-hidden">
            <div className="absolute inset-0 bg-gradient-to-b from-black/20 to-transparent pointer-events-none"></div>
            
            <div 
                ref={scrollContainerRef}
                className="flex gap-8 overflow-x-auto pb-8 pt-2 px-4 no-scrollbar scroll-smooth snap-x snap-mandatory"
            >
                {songs.map((song) => (
                    <div key={song.id} className="relative group flex-shrink-0 snap-center">
                        <Cassette 
                            song={song} 
                            isActive={currentSong.id === song.id}
                            onClick={handleTapeSelect}
                        />
                        {/* Shelf Shadow */}
                        <div className="absolute -bottom-3 left-[5%] w-[90%] h-4 bg-black/50 blur-md rounded-full pointer-events-none"></div>
                    </div>
                ))}
            </div>
            {/* Front Edge of Shelf */}
            <div className="absolute bottom-0 left-0 w-full h-4 bg-gradient-to-b from-[#5d4037] to-[#3e2723] border-t border-[#795548] shadow-[0_-2px_5px_rgba(0,0,0,0.5)]"></div>
        </div>
      </div>

      {/* The Radio Unit with more skeuomorphism */}
      <div className="w-full max-w-3xl brushed-metal rounded-[2.5rem] p-8 shadow-[0_30px_60px_rgba(0,0,0,0.9),inset_0_2px_3px_rgba(255,255,255,0.3)] border-t-[3px] border-l-[3px] border-[#888] border-b-[4px] border-r-[4px] border-[#333] relative overflow-hidden z-10 mt-auto">
        
        {/* Chrome Handle with more detail */}
        <div className="absolute top-0 left-1/2 transform -translate-x-1/2 w-48 h-3 bg-gradient-to-b from-neutral-200 via-neutral-400 to-neutral-600 rounded-b-xl shadow-[0_4px_6px_rgba(0,0,0,0.6)] border-b border-neutral-700">
            <div className="absolute inset-x-4 bottom-1 h-0.5 bg-black/20"></div>
        </div>

        {/* Decorative Screws */}
        <div className="absolute top-5 left-5 w-4 h-4 rounded-full bg-neutral-400 shadow-[inset_1px_1px_2px_rgba(0,0,0,0.8),0_1px_1px_rgba(255,255,255,0.4)] border border-neutral-600 flex items-center justify-center"><div className="w-2 h-0.5 bg-neutral-700 rotate-45"></div></div>
        <div className="absolute top-5 right-5 w-4 h-4 rounded-full bg-neutral-400 shadow-[inset_1px_1px_2px_rgba(0,0,0,0.8),0_1px_1px_rgba(255,255,255,0.4)] border border-neutral-600 flex items-center justify-center"><div className="w-2 h-0.5 bg-neutral-700 -rotate-45"></div></div>

        <div className="flex flex-col md:flex-row gap-8 items-center md:items-stretch mt-6">
          
          {/* Left Side: Speaker */}
          <div className="w-full md:w-1/3 aspect-square relative flex items-center justify-center">
             <SpeakerGrille />
             <div className="absolute bottom-6 right-6 bg-gradient-to-r from-orange-700 to-red-700 text-orange-100 text-[9px] font-bold px-3 py-1.5 rounded-sm uppercase tracking-wider shadow-[1px_1px_3px_rgba(0,0,0,0.8),inset_0_1px_1px_rgba(255,255,255,0.2)] border-t border-l border-orange-500/50 flex items-center gap-1.5">
               <Radio size={12} className="text-orange-300" /> 
               <span className="drop-shadow-sm">Hi-Fi Stereo</span>
             </div>
          </div>

          {/* Right Side: Controls & Display */}
          <div className="flex-1 flex flex-col justify-between w-full gap-6">
            
            {/* Display Screen with more depth */}
            <div className="bg-[#111] rounded-xl p-5 shadow-[inset_0_5px_15px_rgba(0,0,0,0.9),0_2px_3px_rgba(255,255,255,0.1)] relative border-[4px] border-[#333] border-b-[#555] border-r-[#555] h-44 flex flex-col justify-between group overflow-hidden">
              <div 
                className="absolute inset-0 pointer-events-none opacity-40 z-10"
                style={{ backgroundImage: 'linear-gradient(transparent 50%, rgba(0, 255, 150, 0.08) 50%)', backgroundSize: '100% 4px' }}
              ></div>
              <div className="absolute top-0 right-0 w-full h-full bg-gradient-to-bl from-white/10 to-transparent pointer-events-none rounded-lg z-10"></div>
              <div className="absolute inset-0 shadow-[inset_0_0_20px_rgba(0,255,150,0.1)] pointer-events-none z-10"></div>
              
              {/* Top Info Bar */}
              <div className="flex justify-between items-start text-emerald-400/80 text-[10px] font-mono uppercase tracking-wider relative z-20">
                <span className="flex items-center gap-1"><BatteryMedium size={12} /> 80%</span>
                <span className="flex items-center gap-1"><Activity size={12} /> {currentSong.bitrate}</span>
                <span className={`flex items-center gap-1 ${isPlaying ? "text-emerald-300 animate-pulse drop-shadow-[0_0_5px_rgba(0,255,150,0.8)]" : ""}`}>{isPlaying ? "PLAYING" : "STOP"}</span>
              </div>

              {/* Main Song Info */}
              <div className="flex items-center gap-4 relative z-20 my-3">
                 {/* Current Song Art in Display */}
                 <div className={`w-14 h-14 rounded-md flex-shrink-0 flex items-center justify-center ${currentSong.coverColor} shadow-[0_2px_5px_rgba(0,0,0,0.5)] border border-white/20 relative overflow-hidden`}>
                     <div className="absolute inset-0 bg-gradient-to-br from-white/30 to-transparent pointer-events-none"></div>
                     <Music2 size={24} className="text-white/90 drop-shadow-sm" />
                 </div>
                 <div className="min-w-0">
                    <h1 className="text-emerald-300 font-mono text-xl md:text-2xl tracking-tighter truncate leading-tight drop-shadow-[0_0_3px_rgba(0,255,150,0.5)]">
                    {displayTitle}
                    </h1>
                    <p className="text-emerald-500/80 font-mono text-xs uppercase tracking-widest mt-1">
                    {currentSong.artist}
                    </p>
                 </div>
              </div>

              {/* Bottom Info & Visualizer */}
              <div className="flex items-end justify-between relative z-20">
                <div className="text-[10px] font-mono text-emerald-600/80 uppercase flex flex-col gap-0.5">
                  <span>Fmt: {currentSong.format}</span>
                  <span>Tape: {currentSong.type}</span>
                </div>
                <SpectrumVisualizer isPlaying={isPlaying} />
              </div>

              {/* Progress Bar (Visual) */}
              <div className="absolute bottom-0 left-0 w-full bg-[#0a1f15] h-1.5 border-t border-emerald-900/30">
                <div 
                  className="h-full bg-gradient-to-r from-emerald-600 to-emerald-400 transition-all duration-200 ease-linear shadow-[0_0_5px_rgba(0,255,150,0.5)] relative"
                  style={{ width: `${currentTime}%` }}
                >
                    <div className="absolute right-0 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-emerald-300 shadow-[0_0_5px_rgba(0,255,150,1)]"></div>
                </div>
              </div>
            </div>

            {/* Control Panel with Skeuomorphic Buttons */}
            <div className="grid grid-cols-5 gap-5 bg-[#2a2a2a] p-5 rounded-2xl shadow-[inset_0_2px_5px_rgba(0,0,0,0.8),0_1px_2px_rgba(255,255,255,0.1)] border-t border-l border-[#444] border-b border-r border-[#1a1a1a] relative">
              {/* Panel Texture */}
              <div className="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%272%27 height=%272%27%3E%3Cpath d=%27M1 2V0h1v2H0z%27 fill=%27%23000000%27 fill-opacity=%27.1%27/%3E%3C/svg%3E')] opacity-50 rounded-2xl pointer-events-none"></div>
              
              {/* Playback Buttons */}
              <div className="col-span-3 flex items-center justify-evenly z-10">
                 <ControlButton className="p-3.5" onClick={handlePrevTrack}>
                   <SkipBack size={22} fill="currentColor" />
                 </ControlButton>
                 
                 <ControlButton 
                  onClick={togglePlay}
                  isActive={isPlaying}
                  className={`w-16 h-16 ${isPlaying ? '!from-orange-600 !to-orange-800 !border-orange-900' : ''}`}
                 >
                   {isPlaying ? <Pause size={28} fill="currentColor" className="drop-shadow-sm" /> : <Play size={28} fill="currentColor" className="ml-1 drop-shadow-sm" />}
                 </ControlButton>

                 <ControlButton className="p-3.5" onClick={handleNextTrack}>
                   <SkipForward size={22} fill="currentColor" />
                 </ControlButton>
              </div>

              {/* Volume Knob Area */}
              <div className="col-span-2 flex items-center justify-center gap-3 bg-[#222] rounded-xl px-4 shadow-[inset_0_3px_8px_rgba(0,0,0,0.7),0_1px_1px_rgba(255,255,255,0.1)] border-t border-l border-[#333] border-b border-r border-[#111] z-10">
                 <Volume2 size={20} className="text-neutral-500 drop-shadow-sm" />
                 <div className="relative w-full h-2.5 bg-[#111] rounded-full overflow-hidden shadow-[inset_0_2px_4px_rgba(0,0,0,0.9),0_1px_1px_rgba(255,255,255,0.1)] border-b border-[#333]">
                   <input 
                    type="range" 
                    min="0" 
                    max="100" 
                    value={volume} 
                    onChange={handleVolumeChange}
                    className="absolute w-full h-full opacity-0 cursor-pointer z-10"
                   />
                   <div 
                    className="h-full bg-gradient-to-r from-orange-600 via-orange-500 to-orange-400 rounded-full transition-all shadow-[inset_0_1px_2px_rgba(255,255,255,0.3),0_1px_2px_rgba(0,0,0,0.5)] relative"
                    style={{ width: `${volume}%` }}
                   >
                        <div className="absolute right-0 top-0 h-full w-2.5 bg-gradient-to-b from-neutral-300 to-neutral-500 rounded-full shadow-[inset_0_1px_1px_rgba(255,255,255,0.5),0_1px_2px_rgba(0,0,0,0.7)] border-l border-neutral-600"></div>
                   </div>
                 </div>
              </div>

            </div>
          </div>
        </div>
        <audio ref={audioRef} className="hidden" />
      </div>
    </div>
  );
} 
